<?xml version="1.0" encoding="UTF-8"?>
<modification>
	<id>Order callback or one click to order module for Opencart 1.5.x versions</id>
	<version>1.0</version>
	<vqmver>2.0></vqmver>
	<author>Ajay</author>

	<file path="catalog/controller/" name="product/product.php">
        <operation error="log">
            <search position="after"><![CDATA[public function index() {]]></search>
            <add><![CDATA[
                $this->language->load('module/ordercallback');
                $this->document->addScript('catalog/view/javascript/instup/jquery.maskedinput-1.3.min.js');
                $this->document->addScript('catalog/view/javascript/instup/jquery.validate.min.js');
                $this->document->addScript('catalog/view/javascript/instup/uikit.min.js');
                $this->document->addScript('catalog/view/javascript/instup/instup.js');
                $this->document->addStyle('catalog/view/javascript/instup/instup.css');

                $this->load->model('setting/setting');
                $ordercallback_settings = $this->model_setting_setting->getSetting('ordercallback');
                $ordercallback_settings['modal_title'] = '';

                if ($ordercallback_settings['ordercallback_use_module']) {
                    $data['ordercallback_use_module'] = true;

                    if ($ordercallback_settings['module_works_as'] == 'order') {
                        $data['ordercallback_as_order'] = true;
                        $ordercallback_settings['modal_title'] = $this->language->get('modal_title_order');
                    } else {
                        $data['ordercallback_as_order'] = false;
                        $ordercallback_settings['modal_title'] = $this->language->get('modal_title_call');
                    }

                    $data['modal_field_name'] = $this->language->get('modal_field_name');
                    $data['modal_field_phone'] = $this->language->get('modal_field_phone');
                    $data['modal_field_email'] = $this->language->get('modal_field_email');
                    $data['modal_field_comment'] = $this->language->get('modal_field_comment');
                    $data['button_cancel'] = $this->language->get('button_cancel');
                    $data['button_send'] = $this->language->get('button_send');
                    $data['message_system_error'] = $this->language->get('message_system_error');
                } else {
                    $data['ordercallback_use_module'] = false;
                }

                $data['ordercallback_settings'] = $ordercallback_settings;
                $data['config_template'] = $this->config->get('config_template');
			]]></add>
		</operation>
	</file>

    <file name="catalog/view/theme/*/template/product/product.tpl">
        <operation error="log">
            <search position="after"><![CDATA[<button type="button" id="button-cart" data-loading-text="<?php echo $text_loading; ?>" class="btn btn-primary btn-lg btn-block"><span><span class="sp-button" ><?php echo $button_cart; ?></span></span></button>]]></search>
            <add><![CDATA[
                <?php if ($ordercallback_use_module && $ordercallback_as_order) { ?>
                    &nbsp;<button type="button" data-uk-modal="{target:'#ordercallback-modal'}" class="btn btn-primary btn-lg button-quote"><?php echo $ordercallback_settings['button_caption']; ?></button>
                    <?php
                     if (file_exists(DIR_TEMPLATE . $config_template . '/template/module/ordercallback_modal.tpl')) {
                            $template = $config_template;
                        } else {
                             $template = 'default';
                        }
                        include_once (__DIR__ . '/../../catalog/view/theme/'.$template.'/template/module/ordercallback_modal.tpl');
                    ?>
                <?php } ?>
        ]]></add>
        </operation>
    </file>
</modification>